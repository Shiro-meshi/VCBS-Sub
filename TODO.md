# 此文件为主架构问题

有想法请在下面接上，不要删除其他人所作的回答，删除统一由芙兰(hanyuwei70@qq.com)执行

1. MVC架构下搜索应该怎么做

  + 个人想法是做和别的 action 一样，做一个 action=search *--ParadiseDS*
  + 就是搜索的实现啊，在数据库里找什么，怎么找，我现在都没有太好的思路 *--fulan*
  + 1.首先我觉得，MVC架构里，C负责的是数据的解析和传输，而不是处理，处理应该是M干的活，不该由C本身完成处理工作，果然还是觉得应该在bangumi model里面做。  
    2.搜索的时候，我考虑的一个部分是如何有效地使用MySQL索引，减少资源的占用，现在来看id和name都需要建立索引，但是LIKE子句对于前缀以外的查询都无法使用索引，由此得出的大体思路（搜索番剧名称->返回番剧id）：  
    **a**. 首先关键词处理，干掉多余的空白字符和其他不合法字符以及安全相关处理。  
    **b**. 先做精确搜索，有结果最好，先存下来。  
    **c**. 就我搜索番剧的习惯，很多情况时我都是记得开头的字段，或搜索时从头开始没输入完整，第二部分使用 `LIKE 'WORD%'` 模式匹配，也存下来。  
    **d**. 接下来就是放在结尾搜索，相互要对于 `LIKE '%WORD'` 模式的匹配可以把表内容和关键字都做 reverse 变成上一种情况，应该是可以利用索引的，也存下来。  
    以上应该可以返回一部分结果了，判断一下有多少结果，满足一定数额就把这部分结果先丢出来，最下面显示“更多”链接，如果用户点击更多，那就做全表遍历了。我觉得很大部分人应该在前面的结果里能找到理想匹配（大概。。  
    恩对了，如果搜索字段里带有空格，先判断是不是全英文/罗马音的字段搜索，不是的话应该就是多关键词匹配了，恩这里还需要想想。。我之前看到的情况是设定关键词上限后，设定AND/  OR模式，把关键词提取出来扔在一个LIKE子句里，形如 `LIKE A OR LIKE B OR LIKE C...` 做查询，不知道是分开重复上面的 abcd 还是一次大查询性价比高。  
    不过上面是在现有的名称数据库结构下考虑的结果，能不能在添加的时候就提取某些关键词，或者tag的形式，给搜索使用，减少全表遍历的概率，我暂时也没想到 好的实现。  
    初学，轻拍     *--ParadiseDS*

2. 数据库里各项权限代码定义放在哪里

  + 个人认为放在config.php或者php某个常量文件里面 *--fulan*
  + 放在User_Model里，因为权限系统属于用户抽象 *--fulan*

3. 错误处理逻辑

***

以下是厂长提出的需求

1. 实现多语言用户界面，英文和繁中一定要做

  + 个人觉得用多个语言文件，在用户表里添加lang列，根据lang列require相应语言文件，语言文件使用索引数组存储内容，代码中使用数组索引表示。 *--ParadiseDS*
  + 已经预留此接口，所有输出字符串均用 `echo` 输出，请各位写的时候注意一下。语言文件现在采取直接 PHP 字符串的形式，以后可能调整为xml *--fulan*

2. 添加标签系统，为字幕加上标签，比如xx字幕组标签，等等，同时强制用户添加标签

3. 重复字幕的过滤

  + 个人想法是hash值匹配过滤 *--ParadiseDS*
  + hash过滤只对绝对重复的有效，建议还是以字幕组自行过滤 *--fulan*

4. 无对应番剧的字幕不允许上传，用户可以发出申请添加番剧的请求，该番剧被添加后申请用户会收到提醒

  + 建议不采用，有的时候确实不好组织 *--fulan*

5. 为字幕组提供便利，字幕组需要有官方上传和认领本组字幕的权利，字幕组作品需要提供相应的版权声明

  + 可行，但是建议不作为一期开发内容 *--fulan*

6. 番剧需要有 一个或多个中文，一个繁中，一个日语（必须），一个罗马字母版本 的名称

  + 已预留接口 *--fulan*

7. 多国语言字幕

  + 个人想法是在字幕表也加入语种信息，显示时以国旗/区旗形式标明 *--ParadiseDS*
  + 正在考虑 *--fulan*

7. 通过大数据调动用户积极性，如 你帮助了多少人（上传的字幕的下载次数），等等

  + 可行，但是建议不作为一期开发内容 *--fulan*

8. 西方动画的加入是否有必要，是否需要设立加入门槛（传播是否广泛），如 彩虹小马，猫和老鼠，史努比，超级英雄系列，等等

  + 一视同仁 *--fulan*

9. 自翻/手抄等个人产出的字幕需要特殊考虑（大概是特别鼓励一下之类的？）

  + 需要咨询字幕界的意见 *--fulan*